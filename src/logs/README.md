# Error Logging System

This directory contains error logs generated by the application. The logging system is designed to provide clear, detailed information about errors and issues that occur during runtime, making it easier for developers to diagnose and fix problems.

## Log Format

Logs are stored in JSON format with the following structure:

```json
{
  "level": "ERROR",
  "timestamp": "2023-05-06T12:34:56.789Z",
  "message": "Error message",
  "category": "ComponentName",
  "type": "ERROR_TYPE",
  "details": {
    // Additional data about the error
  },
  "context": {
    "sessionId": "user-session-id",
    "requestId": "request-id",
    "path": "request-path"
  },
  "stackTrace": "Stack trace if available"
}
```

## Log Levels

The logging system uses the following severity levels:

- **INFO**: General information about system operation
- **WARNING**: Issues that don't cause system failure but should be addressed
- **ERROR**: Issues that cause part of the system to fail
- **CRITICAL**: Severe issues that may cause the entire system to fail

## Log File Naming

Log files are named using the format: `app-error-YYYY-MM-DD.log`. A new log file is created each day, and files are rotated when they exceed the maximum size (5MB by default).

## How to View Logs

You can view logs using any text editor. Since logs are in JSON format with line breaks, they're easy to read and analyze.

For better viewing, you can use tools like:
- VSCode with JSON formatter
- `jq` command line tool: `cat app-error-2023-05-06.log | jq`

## Error Categories

The logs contain information from various controllers and services:

- **ChatController**: Errors related to chat message processing and API communication
- **WebhookController**: Errors related to webhook processing, retries, and response formatting
- **Other Components**: Errors from various parts of the application

## Log Retention

By default, the system keeps up to 10 log files. Older logs are automatically deleted when this limit is reached.

## Testing the Logging System

To verify the logging system is working correctly, you can run the test script:

```bash
npx tsx src/utils/logger.test.ts
```

This script will generate test logs for all severity levels and typical error scenarios.

## Troubleshooting Using Logs

When investigating issues:

1. Look for the most recent log entries with ERROR or CRITICAL level
2. Check the `requestId` to trace the full request flow across multiple log entries
3. Examine the `details` section for specific error information
4. Review the stack trace to identify where in the code the error occurred

## For Contributors

When adding new code, use the logging system by importing the logger:

```typescript
import logger from '../utils/logger';

// For info logs
logger.info('Message', 'ComponentName', {
  context: { sessionId, requestId },
  details: { /* relevant data */ }
});

// For error logs
logger.error('Error message', 'ComponentName', {
  type: 'ERROR_TYPE',
  context: { sessionId, requestId },
  details: { /* error details */ },
  stackTrace: error.stack
});
``` 